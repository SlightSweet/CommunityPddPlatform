<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="group.mapper.GroupMapper">

    <select id="findAllGroupActivities" resultType="group.pojo.GroupActivity">
        SELECT * FROM group_activity
    </select>

    <select id="findGroupActivityById" resultType="group.pojo.GroupActivity" parameterType="long">
        SELECT * FROM group_activity WHERE id = #{id}
    </select>

    <select id="findGroupOrdersByActivityId" resultType="group.pojo.GroupOrder" parameterType="long">
        SELECT * FROM group_order WHERE activity_id = #{activityId}
    </select>

    <select id="findGroupOrderById" resultType="group.pojo.GroupOrder" parameterType="long">
        SELECT * FROM group_order WHERE id = #{id}
    </select>

    <insert id="insertGroupOrder" parameterType="group.pojo.GroupOrder" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO group_order(activity_id, leader_id, product_id, group_status, current_members, create_time)
        VALUES(#{activityId}, #{leaderId}, #{productId}, #{groupStatus}, #{currentMembers}, #{createTime})
    </insert>

    <update id="updateGroupOrder" parameterType="group.pojo.GroupOrder">
        UPDATE group_order SET current_members = #{currentMembers}, group_status = #{groupStatus} WHERE id = #{id}
    </update>

    <select id="findGroupOrderMembersByGroupOrderId" resultType="group.pojo.GroupOrderMember" parameterType="long">
        SELECT * FROM group_order_member WHERE order_id = #{orderId}
    </select>

    <insert id="insertGroupOrderMember" parameterType="group.pojo.GroupOrderMember" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO group_order_member(order_id, user_id, join_time)
        VALUES(#{orderId}, #{userId}, #{joinTime})
    </insert>
</mapper>
